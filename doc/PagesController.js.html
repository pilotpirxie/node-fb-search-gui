<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: PagesController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: PagesController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const mongoose = require('mongoose');
const databaseConfig = require('../config/database.js');
mongoose.connect(databaseConfig.mongourl);
const Page = require('../models/pages');

// async for each loop
// https://gist.github.com/Atinux/fd2bcce63e44a7d3addddc166ce93fb2
async function asyncForEach(array, callback) {
    for (let index = 0; index &lt; array.length; index++) {
        await callback(array[index], index, array)
    }
}

/**
 * This controller manages pages data
 * @alias PagesController
 * @constructor
 */
module.exports = {
    /**
     * Add new fanpage
     * @param  {object} pageFields Object that contains information about fanpage
     * @param  {number} reportID ID of relative report
     * @return {promise}
     */
    addPage: function (pageFields, reportID) {
        return new Promise((resolve,reject) => {
            let newPageObj = {
                createDate: (new Date()),
                reportID: reportID,
                name: pageFields.name,
                category: pageFields.category,
                cover: pageFields.cover,
                description: pageFields.description,
                website: pageFields.website,
                checking: Number.parseInt(pageFields.checkins)
            };
            Page.create(newPageObj).then(page => {
                resolve(page);
            }).catch(err => {
                reject(err);
            });
        });
    },

    /**
     * Get all pages for specific report
     * @param  {number} reportID ID of report
     * @return {array}          Pages that match
     */
    getAll: function(reportID) {
        return new Promise((resolve, reject) => {
            Page.find({reportID: reportID}).then(pages => {
                resolve(pages);
            }).catch(err => {
                reject(err);
            });
        });
    },

    /**
     * Get number of matching pages for specific report
     * @param  {number} reportID ID of report
     * @return {array}          Count number that match
     */
    count: function(reports) {
        return new Promise((resolve, reject) => {
            const start = async () => {
                let fpCount = 0;
                let fpKeywords = 0;
                await asyncForEach(reports, async report => {
                    let _keywords = report.keywords + '';
                    fpKeywords += _keywords.split(',').length;
                    await Page.count({reportID: report.id}).then(count => {
                        fpCount += count;
                    }).catch(err => {
                        reject(err);
                    });
                });
                resolve({countNumb: fpCount, keywordsNumb: fpKeywords});
            }
            start();
        });
    },
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="GraphController.html">GraphController</a></li><li><a href="PagesController.html">PagesController</a></li><li><a href="ReportsController.html">ReportsController</a></li><li><a href="UsersController.html">UsersController</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Jun 16 2018 01:17:52 GMT+0200 (Åšrodkowoeuropejski czas letni)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
